<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ ì•”í˜¸ ë³€í™˜ê¸° (ë©”ëª¨ì¥ í…Œë§ˆ)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* ----- 'ì†ê¸€ì”¨ ë©”ëª¨ì¥' í…Œë§ˆ by Gemini (ë ˆì´ì•„ì›ƒ ìˆ˜ì • ë²„ì „ 2) ----- */
        body {
            font-family: 'Gaegu', cursive;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            background-color: #fdfaf4;
            color: #5d534a;
            min-height: 95vh;
        }
        h1 {
            color: #d98a8a;
            font-size: 2.5em;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.1);
            text-align: center;
        }
        h2 {
            font-size: 1.5em;
            color: #a78f80;
        }
        #mainContent {
            display: none; width: 100%; flex-direction: column; align-items: center;
        }
        .container {
            width: 90%;
            max-width: 1500px;
            display: flex;
            gap: 20px;
            align-items: stretch;
        }
        .main-box {
            flex: 3; /* [ë³€ê²½] ë¹„ìœ¨ì„ 2ì—ì„œ 3ìœ¼ë¡œ ëŠ˜ë ¤ ì´ ì˜ì—­ì„ ë” ë„“ê²Œ ë§Œë“­ë‹ˆë‹¤ */
            display: flex;
            gap: 20px;
        }
        .rules-box {
            flex: 1; /* ì˜¤ë¥¸ìª½ ê·œì¹™ ì˜ì—­ì´ 1ì˜ ë¹„ìœ¨ì„ ì°¨ì§€ */
            display: flex;
            flex-direction: column;
        }
        .box {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-in-out;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .box:hover, .rules-box:hover {
            transform: translateY(-5px);
        }
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #e6d1d1;
            border-radius: 10px;
            font-size: 18px;
            font-family: 'Gaegu', cursive;
            resize: vertical;
            box-sizing: border-box;
            background-color: #fffefb;
            transition: border-color 0.2s, box-shadow 0.2s;
            flex-grow: 1;
        }
        textarea:focus {
            outline: none;
            border-color: #d98a8a;
            box-shadow: 0 0 10px rgba(217, 138, 138, 0.2);
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 20px;
            background-color: #d98a8a;
            color: white;
            font-size: 16px;
            font-family: 'Gaegu', cursive;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: #c77a7a;
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.98);
        }
        button.clear {
            background-color: #a78f80;
        }
        button.clear:hover {
            background-color: #8e786a;
        }
        .char-count { font-size: 14px; color: #666; margin-left: auto; }
        .warning { margin-top: 20px; font-size: 14px; color: #d93025; text-align: center; font-weight: bold; }
    </style>

</head>
<body>

<div id="mainContent">
    <h1>ë‚˜ë§Œì˜ ì•”í˜¸ ë³€í™˜ê¸°<br>(ì†ê¸€ì”¨ ë©”ëª¨ì¥ í…Œë§ˆ)</h1>
    <div class="container">
        <div class="main-box" style="display: flex; gap: 20px;">
            <div class="box"><h2>í•œê¸€ ì…ë ¥</h2><textarea id="koreanInput" placeholder="í•œê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><div class="controls"><button id="copyKoreanBtn">í•œê¸€ ë³µì‚¬</button><button id="clearAllBtn" class="clear">ì „ì²´ ì‚­ì œ</button><div id="koreanCharCount" class="char-count">0ì</div></div></div>
            <div class="box"><h2>ì½”ë“œ ë³€í™˜</h2><textarea id="codeInput" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea><div class="controls"><button id="copyCodeBtn">ì½”ë“œ ë³µì‚¬</button><div id="codeCharCount" class="char-count">0ì</div></div></div>
        </div>
        <div class="rules-box"><h2>ë³€í™˜ ê·œì¹™</h2><textarea id="rulesTextarea"></textarea><div class="controls"><button id="applyRulesBtn">ê·œì¹™ ì ìš©</button></div></div>
    </div>
    <div class="warning">âš ï¸ ì´ ë„êµ¬ëŠ” ê·œì¹™ í…ŒìŠ¤íŠ¸ ë° êµìœ¡ìš©ì…ë‹ˆë‹¤.</div>
</div>

<script>
    // --- ë³€ìˆ˜ ë° ìƒìˆ˜ ì •ì˜ ---
    const koreanTextarea = document.getElementById('koreanInput');
    const codeTextarea = document.getElementById('codeInput');
    const rulesTextarea = document.getElementById('rulesTextarea');
    const applyRulesBtn = document.getElementById('applyRulesBtn');
    const copyKoreanBtn = document.getElementById('copyKoreanBtn');
    const copyCodeBtn = document.getElementById('copyCodeBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const koreanCharCount = document.getElementById('koreanCharCount');
    const codeCharCount = document.getElementById('codeCharCount');
    let korToEng = {}, engToKor = {};

    // --- í•œê¸€ êµ¬ì„± ìƒìˆ˜ ---
    const KOREAN_START_CODE = 44032; // 'ê°€'ì˜ ìœ ë‹ˆì½”ë“œ ì½”ë“œ í¬ì¸íŠ¸
    const CHOSEONG = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
    const JUNGSEONG = ['ã…','ã…','ã…‘','ã…’','ã…“','ã…”','ã…•','ã…–','ã…—','ã…˜','ã…™','ã…š','ã…›','ã…œ','ã…','ã…','ã…Ÿ','ã… ','ã…¡','ã…¢','ã…£'];
    const JONGSEONG = ['', 'ã„±','ã„²','ã„³','ã„´','ã„µ','ã„¶','ã„·','ã„¹','ã„º','ã„»','ã„¼','ã„½','ã„¾','ã„¿','ã…€','ã…','ã…‚','ã…„','ã……','ã…†','ã…‡','ã…ˆ','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
    
    // --- ì¡°í•© ê·œì¹™ ìƒìˆ˜ ---
    const JUNGSEONG_COMBINATIONS = { 'ã…—ã…':'ã…˜', 'ã…—ã…':'ã…™', 'ã…—ã…£':'ã…š', 'ã…œã…“':'ã…', 'ã…œã…”':'ã…', 'ã…œã…£':'ã…Ÿ', 'ã…¡ã…£':'ã…¢' };
    const JONGSEONG_COMBINATIONS = { 'ã„±ã……':'ã„³', 'ã„´ã…ˆ':'ã„µ', 'ã„´ã…':'ã„¶', 'ã„¹ã„±':'ã„º', 'ã„¹ã…':'ã„»', 'ã„¹ã…‚':'ã„¼', 'ã„¹ã……':'ã„½', 'ã„¹ã…Œ':'ã„¾', 'ã„¹ã…':'ã„¿', 'ã„¹ã…':'ã…€', 'ã…‚ã……':'ã…„' };
    
    // [ìˆ˜ì •ë¨] ê²¹ë°›ì¹¨ ë¶„í•´ ê·œì¹™ ì¶”ê°€
    const REVERSE_JONGSEONG_COMBINATIONS = {
        'ã„³': ['ã„±', 'ã……'], 'ã„µ': ['ã„´', 'ã…ˆ'], 'ã„¶': ['ã„´', 'ã…'],
        'ã„º': ['ã„¹', 'ã„±'], 'ã„»': ['ã„¹', 'ã…'], 'ã„¼': ['ã„¹', 'ã…‚'],
        'ã„½': ['ã„¹', 'ã……'], 'ã„¾': ['ã„¹', 'ã…Œ'], 'ã„¿': ['ã„¹', 'ã…'],
        'ã…€': ['ã„¹', 'ã…'], 'ã…„': ['ã…‚', 'ã……']
    };

    // --- í•¨ìˆ˜ ì •ì˜ ---

    // ê·œì¹™ í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•˜ì—¬ ë³€í™˜ ë§µ(korToEng, engToKor)ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    function parseAndApplyRules() {
        korToEng = {}; engToKor = {};
        const rules = rulesTextarea.value.split('\n');
        rules.forEach(line => {
            if (line.startsWith('#') || line.trim() === '') return; // ì£¼ì„ì´ë‚˜ ë¹ˆ ì¤„ì€ ë¬´ì‹œ
            const parts = line.split(':');
            if (parts.length === 2) {
                const kor = parts[0].trim();
                const eng = parts[1].trim();
                if (kor && eng) { korToEng[kor] = eng; engToKor[eng] = kor; }
            }
        });
        updateConversion(true); // ê·œì¹™ ì ìš© í›„ í•œê¸€->ì½”ë“œ ë³€í™˜ì„ ë‹¤ì‹œ ì‹¤í–‰
    }
    
    // í•œê¸€ í…ìŠ¤íŠ¸ë¥¼ ì½”ë“œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function convertToCode(koreanText) {
        let result = "";
        for (const char of koreanText) {
            const charCode = char.charCodeAt(0);
            if (charCode >= KOREAN_START_CODE && charCode <= 55203) { // í•œê¸€ ìŒì ˆ ë²”ìœ„ í™•ì¸
                const baseCode = charCode - KOREAN_START_CODE;
                const jongseongIndex = baseCode % 28;
                const jungseongIndex = ((baseCode - jongseongIndex) / 28) % 21;
                const choseongIndex = Math.floor(((baseCode - jongseongIndex) / 28) / 21);
                
                result += korToEng[CHOSEONG[choseongIndex]] || CHOSEONG[choseongIndex];
                result += korToEng[JUNGSEONG[jungseongIndex]] || JUNGSEONG[jungseongIndex];
                if (jongseongIndex > 0) result += korToEng[JONGSEONG[jongseongIndex]] || JONGSEONG[jongseongIndex];
            } else { // í•œê¸€ ìŒì ˆì´ ì•„ë‹Œ ê²½ìš° (ìëª¨, íŠ¹ìˆ˜ë¬¸ì ë“±)
                result += korToEng[char] || char; 
            }
        }
        return result;
    }
    
    // [ìˆ˜ì •ë¨] ì½”ë“œë¥¼ í•œê¸€ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (ê²¹ë°›ì¹¨ ë¡œì§ ìˆ˜ì •)
    function convertToKorean(codeText) {
        let jamoStream = [];
        const sortedCodes = Object.keys(engToKor).sort((a, b) => b.length - a.length);
        let i = 0;
        while (i < codeText.length) {
            let found = false;
            for (const code of sortedCodes) {
                if (codeText.substring(i, i + code.length) === code) {
                    jamoStream.push(engToKor[code]); i += code.length; found = true; break;
                }
            }
            if (!found) { jamoStream.push(codeText[i]); i++; }
        }

        let result = "", buffer = [];
        const commitSyllable = () => {
            if (buffer.length === 0) return;
            const [ch, ju, jo] = buffer;
            if (!CHOSEONG.includes(ch)) { result += buffer.join(''); buffer = []; return; }
            if (!ju) { result += ch; buffer = []; return; }
            const chIndex = CHOSEONG.indexOf(ch), juIndex = JUNGSEONG.indexOf(ju), joIndex = jo ? JONGSEONG.indexOf(jo) : 0;
            if (chIndex === -1 || juIndex === -1 || joIndex === -1) {
                result += buffer.join(''); buffer = []; return;
            }
            result += String.fromCharCode(KOREAN_START_CODE + (chIndex * 21 * 28) + (juIndex * 28) + joIndex);
            buffer = [];
        };

        for (const jamo of jamoStream) {
            if (jamo === ' ') {
                commitSyllable(); result += ' '; continue;
            }

            if (buffer.length === 0) {
                if (CHOSEONG.includes(jamo)) buffer.push(jamo); else result += jamo;
            } else if (buffer.length === 1) {
                if (JUNGSEONG.includes(jamo)) buffer.push(jamo);
                else { commitSyllable(); if (CHOSEONG.includes(jamo)) buffer.push(jamo); else result += jamo; }
            } else if (buffer.length === 2) {
                const [ch, ju] = buffer;
                const combinedJung = JUNGSEONG_COMBINATIONS[ju + jamo];
                if (JONGSEONG.includes(jamo) && JONGSEONG.indexOf(jamo) !== 0) { buffer.push(jamo); }
                else if (JUNGSEONG.includes(jamo) && combinedJung) { buffer[1] = combinedJung; }
                else { commitSyllable(); if (CHOSEONG.includes(jamo)) buffer.push(jamo); else result += jamo; }
            } else if (buffer.length === 3) {
                const [ch, ju, jo] = buffer;
                const isNextJamoJungseong = JUNGSEONG.includes(jamo);
                const combinedJong = JONGSEONG_COMBINATIONS[jo + jamo];

                if (isNextJamoJungseong) {
                    const splittableJong = REVERSE_JONGSEONG_COMBINATIONS[jo];
                    if (splittableJong) { // ê²¹ë°›ì¹¨ì´ê³  ë’¤ì— ëª¨ìŒì´ ì˜¤ëŠ” ê²½ìš° (ì˜ˆ: 'ë‹­ì´'ì˜ 'ë‹­ã…‡')
                        const [first, second] = splittableJong;
                        buffer[2] = first;       // ì• ê¸€ìì˜ ë°›ì¹¨ì„ ê²¹ë°›ì¹¨ì˜ ì²« ììŒìœ¼ë¡œ ë°”ê¿ˆ ('ã„·ã…ã„º' -> 'ã„·ã…ã„¹')
                        commitSyllable();        // ì• ê¸€ìë¥¼ ì™„ì„± ('ë‹¬')
                        buffer.push(second, jamo); // ìƒˆ ê¸€ìì˜ ì´ˆì„±ê³¼ ì¤‘ì„±ì„ bufferì— ë„£ìŒ (['ã„±', 'ã…£'])
                    } else { // í™‘ë°›ì¹¨ì´ê³  ë’¤ì— ëª¨ìŒì´ ì˜¤ëŠ” ê²½ìš° (ì˜ˆ: 'êµ­ì´'ì˜ 'êµ­ã…‡')
                        buffer.pop();            // ë°›ì¹¨ì„ ì œê±° ('ã„±ã…œã„±' -> 'ã„±ã…œ')
                        commitSyllable();        // ì• ê¸€ìë¥¼ ì™„ì„± ('êµ¬')
                        buffer.push(jo, jamo);   // ìƒˆ ê¸€ìì˜ ì´ˆì„±ê³¼ ì¤‘ì„±ì„ bufferì— ë„£ìŒ (['ã„±', 'ã…£'])
                    }
                } else if (combinedJong) { // ë’¤ì— ììŒì´ ì™€ì„œ ìƒˆë¡œìš´ ê²¹ë°›ì¹¨ì´ ë˜ëŠ” ê²½ìš° (ì˜ˆ: 'ì•Š'ì˜ 'ì•ˆã…')
                    buffer[2] = combinedJong;
                } else { // ë”ì´ìƒ ì¡°í•©ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°
                    commitSyllable();
                    if (CHOSEONG.includes(jamo)) buffer.push(jamo); else result += jamo;
                }
            }
        }
        commitSyllable();
        return result;
    }

    // ê¸€ì ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateCharCounts() { 
        koreanCharCount.textContent = `${koreanTextarea.value.length}ì`; 
        codeCharCount.textContent = `${codeTextarea.value.length}ì`; 
    }
    
    // ì…ë ¥ì— ë”°ë¼ ë³€í™˜ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateConversion(isKoreanToCode) {
        if (isKoreanToCode) { 
            codeTextarea.value = convertToCode(koreanTextarea.value); 
        } else { 
            koreanTextarea.value = convertToKorean(codeTextarea.value); 
        }
        updateCharCounts();
    }
    
    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
    koreanTextarea.addEventListener('input', () => updateConversion(true));
    codeInput.addEventListener('input', () => updateConversion(false));
    applyRulesBtn.addEventListener('click', parseAndApplyRules);
    clearAllBtn.addEventListener('click', () => { 
        koreanTextarea.value = ''; 
        codeTextarea.value = ''; 
        updateCharCounts(); 
    });
    copyKoreanBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(koreanTextarea.value).then(() => alert('í•œê¸€ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'));
    });
    copyCodeBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(codeTextarea.value).then(() => alert('ì½”ë“œ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'));
    });
    
    // --- ì´ˆê¸°í™” í•¨ìˆ˜ ---
    function initialize() {
        const defaultRules = `# --- ììŒ ê·œì¹™ ---
ã„±:ê·¸
ã„²:ê¸°
ã„´:ëŠ
ã„·:ë“œ
ã„¸:ë””
ã„¹:ë¥´
ã…:ë¯€
ã…‚:ë¸Œ
ã…ƒ:ë¹„
ã……:ìŠ¤
ã…†:ì‹œ
ã…‡:ìœ¼
ã…ˆ:ì¦ˆ
ã…‰:ì§€
ã…Š:ì¸ 
ã…‹:í¬
ã…Œ:íŠ¸
ã…:í”„
ã…:í
# --- ê²¹ë°›ì¹¨ ê·œì¹™ ---
ã„³:ê·¸ìŠ¤
ã„µ:ëŠì¦ˆ
ã„¶:ëŠí
ã„º:ë¥´ê·¸
ã„»:ë¥´ë¯€
ã„¼:ë¥´ë¸Œ
ã„½:ë¥´ìŠ¤
ã„¾:ë¥´íŠ¸
ã„¿:ë¥´í”„
ã…€:ë¥´í
ã…„:ë¸ŒìŠ¤
# --- ëª¨ìŒ ê·œì¹™ ---
ã…:1
ã…:10
ã…‘:â¤
ã…’:â¤0
ã…“:ğŸ€
ã…”:ğŸ€0
ã…•:4
ã…–:40
ã…—:Î´
ã…˜:Î´1
ã…™:Î´10
ã…š:Î´0
ã…›:6
ã…œ:Í²
ã…:Í²ğŸ€
ã…:Í²ğŸ€0
ã…Ÿ:Í²0
ã… :8
ã…¡:9
ã…¢:90
ã…£:0`;
        rulesTextarea.value = defaultRules;
        parseAndApplyRules(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ê·œì¹™ì„ ì ìš©
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
    initialize();
</script>

<script>
    // --- í˜ì´ì§€ ì ‘ê·¼ ë¹„ë°€ë²ˆí˜¸ ìŠ¤í¬ë¦½íŠ¸ ---
    (function() {
        const correctPassword = "7295"; 
        const enteredPassword = prompt("ì‚¬ì´íŠ¸ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "");
        if (enteredPassword === correctPassword) {
            document.getElementById("mainContent").style.display = 'flex';
        } else if (enteredPassword !== null) {
            alert("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
            document.body.innerHTML = '<h1 style="text-align:center; margin-top: 50px; color: #5d534a; font-family: \'Gaegu\', cursive;">ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.</h1>';
        } else {
             document.body.innerHTML = '<h1 style="text-align:center; margin-top: 50px; color: #5d534a; font-family: \'Gaegu\', cursive;">ì ‘ê·¼ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.</h1>';
        }
    })();
</script>

</body>
</html>
